---
interface Props {
  module: number;
  lesson: number;
}

const { module, lesson } = Astro.props;

// Module and lesson structure
const moduleData = {
  1: {
    name: 'Foundations',
    lessons: [
      { id: 1, title: 'Vectors in Robotics', path: '/modules/01-foundations/01-vectors' },
      { id: 2, title: 'Dot Product & Projections', path: '/modules/01-foundations/02-dot-product' },
      { id: 3, title: 'Cross Product', path: '/modules/01-foundations/03-cross-product' }
    ]
  },
  2: {
    name: 'Matrices',
    lessons: [
      { id: 1, title: 'Matrix Fundamentals', path: '/modules/02-matrices/01-fundamentals' },
      { id: 2, title: 'Matrix Multiplication', path: '/modules/02-matrices/02-multiplication' },
      { id: 3, title: 'Determinants & Inverses', path: '/modules/02-matrices/03-determinants' }
    ]
  },
  3: {
    name: 'Transformations',
    lessons: [
      { id: 1, title: '2D Transformations', path: '/modules/03-transformations/01-2d-transforms' },
      { id: 2, title: '3D Rotations', path: '/modules/03-transformations/02-3d-rotations' },
      { id: 3, title: 'Homogeneous Coordinates', path: '/modules/03-transformations/03-homogeneous' }
    ]
  },
  4: {
    name: 'Advanced',
    lessons: [
      { id: 1, title: 'Eigenvalues & Eigenvectors', path: '/modules/04-advanced/01-eigenvalues' },
      { id: 2, title: 'Coordinate Frames', path: '/modules/04-advanced/02-frames' },
      { id: 3, title: 'Rotation Representations', path: '/modules/04-advanced/03-rotation-representations' }
    ]
  },
  5: {
    name: 'Applications',
    lessons: [
      { id: 1, title: 'Forward Kinematics', path: '/modules/05-applications/01-forward-kinematics' },
      { id: 2, title: 'Velocity Kinematics', path: '/modules/05-applications/02-velocity-kinematics' },
      { id: 3, title: 'Path Planning', path: '/modules/05-applications/03-path-planning' }
    ]
  }
};

const currentModule = moduleData[module as keyof typeof moduleData];
const currentLesson = currentModule?.lessons.find(l => l.id === lesson);

// Find previous and next lessons
let prevLesson = null;
let nextLesson = null;

if (currentModule) {
  const currentIndex = currentModule.lessons.findIndex(l => l.id === lesson);

  if (currentIndex > 0) {
    prevLesson = currentModule.lessons[currentIndex - 1];
  } else if (module > 1) {
    // Get last lesson of previous module
    const prevModule = moduleData[(module - 1) as keyof typeof moduleData];
    prevLesson = prevModule.lessons[prevModule.lessons.length - 1];
  }

  if (currentIndex < currentModule.lessons.length - 1) {
    nextLesson = currentModule.lessons[currentIndex + 1];
  } else if (module < 5) {
    // Get first lesson of next module
    const nextModule = moduleData[(module + 1) as keyof typeof moduleData];
    nextLesson = nextModule.lessons[0];
  }
}
---

<div class="mb-8">
  <!-- Breadcrumb -->
  <div class="text-sm breadcrumbs mb-4">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href={`/modules/0${module}-${currentModule.name.toLowerCase()}`}>Module {module}: {currentModule.name}</a></li>
      <li>{currentLesson?.title}</li>
    </ul>
  </div>

  <!-- Progress Bar -->
  <div class="mb-4">
    <div class="flex items-center justify-between text-sm mb-2">
      <span class="font-medium">Module {module}: {currentModule.name}</span>
      <span class="text-base-content/60">Lesson {lesson} of {currentModule.lessons.length}</span>
    </div>
    <progress
      class="progress progress-primary w-full"
      value={lesson}
      max={currentModule.lessons.length}
    ></progress>
  </div>

  <!-- Previous/Next Navigation -->
  <div class="flex justify-between items-center mt-6">
    <div>
      {prevLesson && (
        <a href={prevLesson.path} class="btn btn-outline btn-sm gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Previous
        </a>
      )}
    </div>

    <div>
      {nextLesson && (
        <a href={nextLesson.path} class="btn btn-primary btn-sm gap-2">
          Next
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      )}
    </div>
  </div>
</div>
